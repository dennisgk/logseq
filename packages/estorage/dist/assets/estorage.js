(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function c(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();const O="http://localhost:8000";function M(s,n){if(!s.ok)throw new Error(`${n} failed: ${s.status} ${s.statusText}`)}function dt(s){const n=String(s||"").replace(/^\/+/,"");return n?n.split("/").map(r=>encodeURIComponent(r)).join("/"):""}async function bt(s){const n=`${O}/estorage`,r=await fetch(n,{method:"GET",credentials:"include",signal:s?.signal});return M(r,"listDBs"),await r.json()}async function vt(s,n,r){const c=`${O}/estorage/${encodeURIComponent(s)}`,i=new FormData;i.append("file",n,n.name??"export.zip");const a=await fetch(c,{method:"POST",body:i,credentials:"include",signal:r?.signal});return M(a,"uploadDBZip"),await a.json()}async function kt(s,n,r){const c=dt(n),i=`${O}/estorage/${encodeURIComponent(s)}/${c}`,a=await fetch(i,{method:"GET",credentials:"include",signal:r?.signal,headers:{Accept:"application/json"}});return M(a,"listDBDir"),await a.json()}async function ft(s,n,r){const c=dt(n),i=`${O}/estorage/${encodeURIComponent(s)}/${c}`,a=await fetch(i,{method:"GET",credentials:"include",signal:r?.signal});M(a,"fetchDBFileBytes");const o=await a.arrayBuffer();return new Uint8Array(o)}var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gt(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function St(s){if(Object.prototype.hasOwnProperty.call(s,"__esModule"))return s;var n=s.default;if(typeof n=="function"){var r=function c(){var i=!1;try{i=this instanceof c}catch{}return i?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};r.prototype=n.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(s).forEach(function(c){var i=Object.getOwnPropertyDescriptor(s,c);Object.defineProperty(r,c,i.get?i:{enumerable:!0,get:function(){return s[c]}})}),r}var B,Z;function Et(){if(Z)return B;Z=1,B=s;function s(n){var r,c;if(typeof n!="function")throw new Error("expected a function but got "+n);return function(){return r||(r=!0,c=n.apply(this,arguments)),c}}return B}var I={},Q;function Ft(){return Q||(Q=1,(function(s){function n(u,d){var y;return u instanceof Buffer?y=u:y=Buffer.from(u.buffer,u.byteOffset,u.byteLength),y.toString(d)}var r=function(u){return Buffer.from(u)};function c(u){for(var d=0,y=Math.min(256*256,u.length+1),b=new Uint16Array(y),S=[],k=0;;){var g=d<u.length;if(!g||k>=y-1){var D=b.subarray(0,k),x=D;if(S.push(String.fromCharCode.apply(null,x)),!g)return S.join("");u=u.subarray(d),d=0,k=0}var E=u[d++];if((E&128)===0)b[k++]=E;else if((E&224)===192){var T=u[d++]&63;b[k++]=(E&31)<<6|T}else if((E&240)===224){var T=u[d++]&63,R=u[d++]&63;b[k++]=(E&31)<<12|T<<6|R}else if((E&248)===240){var T=u[d++]&63,R=u[d++]&63,yt=u[d++]&63,P=(E&7)<<18|T<<12|R<<6|yt;P>65535&&(P-=65536,b[k++]=P>>>10&1023|55296,P=56320|P&1023),b[k++]=P}}}function i(u){for(var d=0,y=u.length,b=0,S=Math.max(32,y+(y>>>1)+7),k=new Uint8Array(S>>>3<<3);d<y;){var g=u.charCodeAt(d++);if(g>=55296&&g<=56319){if(d<y){var D=u.charCodeAt(d);(D&64512)===56320&&(++d,g=((g&1023)<<10)+(D&1023)+65536)}if(g>=55296&&g<=56319)continue}if(b+4>k.length){S+=8,S*=1+d/u.length*2,S=S>>>3<<3;var x=new Uint8Array(S);x.set(k),k=x}if((g&4294967168)===0){k[b++]=g;continue}else if((g&4294965248)===0)k[b++]=g>>>6&31|192;else if((g&4294901760)===0)k[b++]=g>>>12&15|224,k[b++]=g>>>6&63|128;else if((g&4292870144)===0)k[b++]=g>>>18&7|240,k[b++]=g>>>12&63|128,k[b++]=g>>>6&63|128;else continue;k[b++]=g&63|128}return k.slice?k.slice(0,b):k.subarray(0,b)}var a="Failed to ",o=function(u,d,y){if(u)throw new Error("".concat(a).concat(d,": the '").concat(y,"' option is unsupported."))},e=typeof Buffer=="function"&&Buffer.from,t=e?r:i;function h(){this.encoding="utf-8"}h.prototype.encode=function(u,d){return o(d&&d.stream,"encode","stream"),t(u)};function _(u){var d;try{var y=new Blob([u],{type:"text/plain;charset=UTF-8"});d=URL.createObjectURL(y);var b=new XMLHttpRequest;return b.open("GET",d,!1),b.send(),b.responseText}finally{d&&URL.revokeObjectURL(d)}}var m=!e&&typeof Blob=="function"&&typeof URL=="function"&&typeof URL.createObjectURL=="function",v=["utf-8","utf8","unicode-1-1-utf-8"],l=c;e?l=n:m&&(l=function(u){try{return _(u)}catch{return c(u)}});var f="construct 'TextDecoder'",p="".concat(a," ").concat(f,": the ");function w(u,d){o(d&&d.fatal,f,"fatal"),u=u||"utf-8";var y;if(e?y=Buffer.isEncoding(u):y=v.indexOf(u.toLowerCase())!==-1,!y)throw new RangeError("".concat(p," encoding label provided ('").concat(u,"') is invalid."));this.encoding=u,this.fatal=!1,this.ignoreBOM=!1}w.prototype.decode=function(u,d){o(d&&d.stream,"decode","stream");var y;return u instanceof Uint8Array?y=u:u.buffer instanceof ArrayBuffer?y=new Uint8Array(u.buffer):y=new Uint8Array(u),l(y,this.encoding)},s.TextEncoder=s.TextEncoder||h,s.TextDecoder=s.TextDecoder||w})(typeof window<"u"?window:typeof K<"u"?K:I)),I}var q,V;function Pt(){return V||(V=1,Ft(),q={encode:s=>new TextEncoder().encode(s),decode:s=>new TextDecoder().decode(s)}),q}var j,tt;function Tt(){if(tt)return j;tt=1,j=s;function s(n,r,c){var i;return function(){if(!r)return n.apply(this,arguments);var a=this,o=arguments,e=c&&!i;if(clearTimeout(i),i=setTimeout(function(){if(i=null,!e)return n.apply(a,o)},r),e)return n.apply(this,arguments)}}return j}var $,et;function Y(){if(et)return $;et=1;function s(e){if(e.length===0)return".";let t=c(e);return t=t.reduce(o,[]),r(...t)}function n(...e){let t="";for(let h of e)h.startsWith("/")?t=h:t=s(r(t,h));return t}function r(...e){if(e.length===0)return"";let t=e.join("/");return t=t.replace(/\/{2,}/g,"/"),t}function c(e){if(e.length===0)return[];if(e==="/")return["/"];let t=e.split("/");return t[t.length-1]===""&&t.pop(),e[0]==="/"?t[0]="/":t[0]!=="."&&t.unshift("."),t}function i(e){const t=e.lastIndexOf("/");if(t===-1)throw new Error(`Cannot get dirname of "${e}"`);return t===0?"/":e.slice(0,t)}function a(e){if(e==="/")throw new Error(`Cannot get basename of "${e}"`);const t=e.lastIndexOf("/");return t===-1?e:e.slice(t+1)}function o(e,t){if(e.length===0)return e.push(t),e;if(t===".")return e;if(t===".."){if(e.length===1){if(e[0]==="/")throw new Error("Unable to normalize path - traverses above root directory");if(e[0]===".")return e.push(t),e}return e[e.length-1]===".."?(e.push(".."),e):(e.pop(),e)}return e.push(t),e}return $={join:r,normalize:s,split:c,basename:a,dirname:i,resolve:n},$}var N,it;function _t(){if(it)return N;it=1;function s(e){return class extends Error{constructor(...t){super(...t),this.code=e,this.message?this.message=e+": "+this.message:this.message=e}}}const n=s("EEXIST"),r=s("ENOENT"),c=s("ENOTDIR"),i=s("ENOTEMPTY"),a=s("ETIMEDOUT"),o=s("EISDIR");return N={EEXIST:n,ENOENT:r,ENOTDIR:c,ENOTEMPTY:i,ETIMEDOUT:a,EISDIR:o},N}var z,rt;function Dt(){if(rt)return z;rt=1;const s=Y(),{EEXIST:n,ENOENT:r,ENOTDIR:c,ENOTEMPTY:i,EISDIR:a}=_t(),o=0;return z=class{constructor(){}_makeRoot(t=new Map){return t.set(o,{mode:511,type:"dir",size:0,ino:0,mtimeMs:Date.now()}),t}activate(t=null){t===null?this._root=new Map([["/",this._makeRoot()]]):typeof t=="string"?this._root=new Map([["/",this._makeRoot(this.parse(t))]]):this._root=t}get activated(){return!!this._root}deactivate(){this._root=void 0}size(){return this._countInodes(this._root.get("/"))-1}_countInodes(t){let h=1;for(let[_,m]of t)_!==o&&(h+=this._countInodes(m));return h}autoinc(){return this._maxInode(this._root.get("/"))+1}_maxInode(t){let h=t.get(o).ino;for(let[_,m]of t)_!==o&&(h=Math.max(h,this._maxInode(m)));return h}print(t=this._root.get("/")){let h="";const _=(m,v)=>{for(let[l,f]of m){if(l===0)continue;let p=f.get(o),w=p.mode.toString(8);h+=`${"	".repeat(v)}${l}	${w}`,p.type==="file"?h+=`	${p.size}	${p.mtimeMs}
`:(h+=`
`,_(f,v+1))}};return _(t,0),h}parse(t){let h=0;function _(f){const p=++h,w=f.length===1?"dir":"file";let[u,d,y]=f;return u=parseInt(u,8),d=d?parseInt(d):0,y=y?parseInt(y):Date.now(),new Map([[o,{mode:u,type:w,size:d,mtimeMs:y,ino:p}]])}let m=t.trim().split(`
`),v=this._makeRoot(),l=[{indent:-1,node:v},{indent:0,node:null}];for(let f of m){let w=f.match(/^\t*/)[0].length;f=f.slice(w);let[u,...d]=f.split("	"),y=_(d);if(w<=l[l.length-1].indent)for(;w<=l[l.length-1].indent;)l.pop();l.push({indent:w,node:y}),l[l.length-2].node.set(u,y)}return v}_lookup(t,h=!0){let _=this._root,m="/",v=s.split(t);for(let l=0;l<v.length;++l){let f=v[l];if(_=_.get(f),!_)throw new r(t);if(h||l<v.length-1){const p=_.get(o);if(p.type==="symlink"){let w=s.resolve(m,p.target);_=this._lookup(w)}m?m=s.join(m,f):m=f}}return _}mkdir(t,{mode:h}){if(t==="/")throw new n;let _=this._lookup(s.dirname(t)),m=s.basename(t);if(_.has(m))throw new n;let v=new Map,l={mode:h,type:"dir",size:0,mtimeMs:Date.now(),ino:this.autoinc()};v.set(o,l),_.set(m,v)}rmdir(t){let h=this._lookup(t);if(h.get(o).type!=="dir")throw new c;if(h.size>1)throw new i;let _=this._lookup(s.dirname(t)),m=s.basename(t);_.delete(m)}readdir(t){let h=this._lookup(t);if(h.get(o).type!=="dir")throw new c;return[...h.keys()].filter(_=>typeof _=="string")}writeStat(t,h,{mode:_}){let m,v;try{v=this.stat(t)}catch{}if(v!==void 0){if(v.type==="dir")throw new a;_==null&&(_=v.mode),m=v.ino}_==null&&(_=438),m==null&&(m=this.autoinc());let l=this._lookup(s.dirname(t)),f=s.basename(t),p={mode:_,type:"file",size:h,mtimeMs:Date.now(),ino:m},w=new Map;return w.set(o,p),l.set(f,w),p}unlink(t){let h=this._lookup(s.dirname(t)),_=s.basename(t);h.delete(_)}rename(t,h){let _=s.basename(h),m=this._lookup(t);this._lookup(s.dirname(h)).set(_,m),this.unlink(t)}stat(t){return this._lookup(t).get(o)}lstat(t){return this._lookup(t,!1).get(o)}readlink(t){return this._lookup(t,!1).get(o).target}symlink(t,h){let _,m;try{let w=this.stat(h);m===null&&(m=w.mode),_=w.ino}catch{}m==null&&(m=40960),_==null&&(_=this.autoinc());let v=this._lookup(s.dirname(h)),l=s.basename(h),f={mode:m,type:"symlink",target:t,size:0,mtimeMs:Date.now(),ino:_},p=new Map;return p.set(o,f),v.set(l,p),f}_du(t){let h=0;for(const[_,m]of t.entries())_===o?h+=m.size:h+=this._du(m);return h}du(t){let h=this._lookup(t);return this._du(h)}},z}class mt{constructor(n="keyval-store",r="keyval"){this.storeName=r,this._dbName=n,this._storeName=r,this._init()}_init(){this._dbp||(this._dbp=new Promise((n,r)=>{const c=indexedDB.open(this._dbName);c.onerror=()=>r(c.error),c.onsuccess=()=>n(c.result),c.onupgradeneeded=()=>{c.result.createObjectStore(this._storeName)}}))}_withIDBStore(n,r){return this._init(),this._dbp.then(c=>new Promise((i,a)=>{const o=c.transaction(this.storeName,n);o.oncomplete=()=>i(),o.onabort=o.onerror=()=>a(o.error),r(o.objectStore(this.storeName))}))}_close(){return this._init(),this._dbp.then(n=>{n.close(),this._dbp=void 0})}}let L;function F(){return L||(L=new mt),L}function xt(s,n=F()){let r;return n._withIDBStore("readwrite",c=>{r=c.get(s)}).then(()=>r.result)}function Ot(s,n,r=F()){return r._withIDBStore("readwrite",c=>{c.put(n,s)})}function Mt(s,n,r=F()){return r._withIDBStore("readwrite",c=>{const i=c.get(s);i.onsuccess=()=>{c.put(n(i.result),s)}})}function Rt(s,n=F()){return n._withIDBStore("readwrite",r=>{r.delete(s)})}function Bt(s=F()){return s._withIDBStore("readwrite",n=>{n.clear()})}function It(s=F()){const n=[];return s._withIDBStore("readwrite",r=>{(r.openKeyCursor||r.openCursor).call(r).onsuccess=function(){this.result&&(n.push(this.result.key),this.result.continue())}}).then(()=>n)}function qt(s=F()){return s._close()}const jt=Object.freeze(Object.defineProperty({__proto__:null,Store:mt,clear:Bt,close:qt,del:Rt,get:xt,keys:It,set:Ot,update:Mt},Symbol.toStringTag,{value:"Module"})),wt=St(jt);var U,st;function $t(){if(st)return U;st=1;const s=wt;return U=class{constructor(r,c){this._database=r,this._storename=c,this._store=new s.Store(this._database,this._storename)}saveSuperblock(r){return s.set("!root",r,this._store)}loadSuperblock(){return s.get("!root",this._store)}readFile(r){return s.get(r,this._store)}writeFile(r,c){return s.set(r,c,this._store)}unlink(r){return s.del(r,this._store)}wipe(){return s.clear(this._store)}close(){return s.close(this._store)}},U}var A,nt;function Nt(){return nt||(nt=1,A=class{constructor(n){this._url=n}loadSuperblock(){return fetch(this._url+"/.superblock.txt").then(n=>n.ok?n.text():null)}async readFile(n){const r=await fetch(this._url+n);if(r.status===200)return r.arrayBuffer();throw new Error("ENOENT")}async sizeFile(n){const r=await fetch(this._url+n,{method:"HEAD"});if(r.status===200)return r.headers.get("content-length");throw new Error("ENOENT")}}),A}var C,at;function zt(){if(at)return C;at=1;const s=wt,n=r=>new Promise(c=>setTimeout(c,r));return C=class{constructor(c,i){this._id=Math.random(),this._database=c,this._storename=i,this._store=new s.Store(this._database,this._storename),this._lock=null}async has({margin:c=2e3}={}){if(this._lock&&this._lock.holder===this._id){const i=Date.now();return this._lock.expires>i+c?!0:await this.renew()}else return!1}async renew({ttl:c=5e3}={}){let i;return await s.update("lock",a=>{const e=Date.now()+c;return i=a&&a.holder===this._id,this._lock=i?{holder:this._id,expires:e}:a,this._lock},this._store),i}async acquire({ttl:c=5e3}={}){let i,a,o;if(await s.update("lock",e=>{const t=Date.now(),h=t+c;return a=e&&e.expires<t,i=e===void 0||a,o=e&&e.holder===this._id,this._lock=i?{holder:this._id,expires:h}:e,this._lock},this._store),o)throw new Error("Mutex double-locked");return i}async wait({interval:c=100,limit:i=6e3,ttl:a}={}){for(;i--;){if(await this.acquire({ttl:a}))return!0;await n(c)}throw new Error("Mutex timeout")}async release({force:c=!1}={}){let i,a,o;if(await s.update("lock",e=>(i=c||e&&e.holder===this._id,a=e===void 0,o=e&&e.holder!==this._id,this._lock=i?void 0:e,this._lock),this._store),await s.close(this._store),!i&&!c){if(a)throw new Error("Mutex double-freed");if(o)throw new Error("Mutex lost ownership")}return i}},C}var H,ot;function Lt(){return ot||(ot=1,H=class{constructor(n){this._id=Math.random(),this._database=n,this._has=!1,this._release=null}async has(){return this._has}async acquire(){return new Promise(n=>{navigator.locks.request(this._database+"_lock",{ifAvailable:!0},r=>(this._has=!!r,n(!!r),new Promise(c=>{this._release=c})))})}async wait({timeout:n=6e5}={}){return new Promise((r,c)=>{const i=new AbortController;setTimeout(()=>{i.abort(),c(new Error("Mutex timeout"))},n),navigator.locks.request(this._database+"_lock",{signal:i.signal},a=>(this._has=!!a,r(!!a),new Promise(o=>{this._release=o})))})}async release({force:n=!1}={}){this._has=!1,this._release?this._release():n&&navigator.locks.request(this._database+"_lock",{steal:!0},r=>!0)}}),H}var G,ct;function Ut(){if(ct)return G;ct=1;const{encode:s,decode:n}=Pt(),r=Tt(),c=Dt(),{ENOENT:i,ENOTEMPTY:a,ETIMEDOUT:o}=_t(),e=$t(),t=Nt(),h=zt(),_=Lt(),m=Y();return G=class{constructor(){this.saveSuperblock=r(()=>{this.flush()},500)}async init(l,{wipe:f,url:p,urlauto:w,fileDbName:u=l,db:d=null,fileStoreName:y=l+"_files",lockDbName:b=l+"_lock",lockStoreName:S=l+"_lock"}={}){this._name=l,this._idb=d||new e(u,y),this._mutex=navigator.locks?new _(l):new h(b,S),this._cache=new c(l),this._opts={wipe:f,url:p},this._needsWipe=!!f,p&&(this._http=new t(p),this._urlauto=!!w)}async activate(){if(this._cache.activated)return;this._needsWipe&&(this._needsWipe=!1,await this._idb.wipe(),await this._mutex.release({force:!0})),await this._mutex.has()||await this._mutex.wait();const l=await this._idb.loadSuperblock();if(l)this._cache.activate(l);else if(this._http){const f=await this._http.loadSuperblock();this._cache.activate(f),await this._saveSuperblock()}else this._cache.activate();if(!await this._mutex.has())throw new o}async deactivate(){await this._mutex.has()&&await this._saveSuperblock(),this._cache.deactivate();try{await this._mutex.release()}catch(l){console.log(l)}await this._idb.close()}async _saveSuperblock(){this._cache.activated&&(this._lastSavedAt=Date.now(),await this._idb.saveSuperblock(this._cache._root))}_writeStat(l,f,p){let w=m.split(m.dirname(l)),u=w.shift();for(let d of w){u=m.join(u,d);try{this._cache.mkdir(u,{mode:511})}catch{}}return this._cache.writeStat(l,f,p)}async readFile(l,f){const p=typeof f=="string"?f:f&&f.encoding;if(p&&p!=="utf8")throw new Error('Only "utf8" encoding is supported in readFile');let w=null,u=null;try{u=this._cache.stat(l),w=await this._idb.readFile(u.ino)}catch(d){if(!this._urlauto)throw d}if(!w&&this._http){let d=this._cache.lstat(l);for(;d.type==="symlink";)l=m.resolve(m.dirname(l),d.target),d=this._cache.lstat(l);w=await this._http.readFile(l)}if(w&&((!u||u.size!=w.byteLength)&&(u=await this._writeStat(l,w.byteLength,{mode:u?u.mode:438}),this.saveSuperblock()),p==="utf8"?w=n(w):w.toString=()=>n(w)),!u)throw new i(l);return w}async writeFile(l,f,p){const{mode:w,encoding:u="utf8"}=p;if(typeof f=="string"){if(u!=="utf8")throw new Error('Only "utf8" encoding is supported in writeFile');f=s(f)}const d=await this._cache.writeStat(l,f.byteLength,{mode:w});await this._idb.writeFile(d.ino,f)}async unlink(l,f){const p=this._cache.lstat(l);this._cache.unlink(l),p.type!=="symlink"&&await this._idb.unlink(p.ino)}readdir(l,f){return this._cache.readdir(l)}mkdir(l,f){const{mode:p=511}=f;this._cache.mkdir(l,{mode:p})}rmdir(l,f){if(l==="/")throw new a;this._cache.rmdir(l)}rename(l,f){this._cache.rename(l,f)}stat(l,f){return this._cache.stat(l)}lstat(l,f){return this._cache.lstat(l)}readlink(l,f){return this._cache.readlink(l)}symlink(l,f){this._cache.symlink(l,f)}async backFile(l,f){let p=await this._http.sizeFile(l);await this._writeStat(l,p,f)}du(l){return this._cache.du(l)}flush(){return this._saveSuperblock()}},G}var W,lt;function At(){return lt||(lt=1,W=class{constructor(n){this.type=n.type,this.mode=n.mode,this.size=n.size,this.ino=n.ino,this.mtimeMs=n.mtimeMs,this.ctimeMs=n.ctimeMs||n.mtimeMs,this.uid=1,this.gid=1,this.dev=1}isFile(){return this.type==="file"}isDirectory(){return this.type==="dir"}isSymbolicLink(){return this.type==="symlink"}}),W}var J,ut;function Ct(){if(ut)return J;ut=1;const s=Ut(),n=At(),r=Y();function c(o,e,...t){return o=r.normalize(o),(typeof e>"u"||typeof e=="function")&&(e={}),typeof e=="string"&&(e={encoding:e}),[o,e,...t]}function i(o,e,t,...h){return o=r.normalize(o),(typeof t>"u"||typeof t=="function")&&(t={}),typeof t=="string"&&(t={encoding:t}),[o,e,t,...h]}function a(o,e,...t){return[r.normalize(o),r.normalize(e),...t]}return J=class{constructor(e,t={}){this.init=this.init.bind(this),this.readFile=this._wrap(this.readFile,c,!1),this.writeFile=this._wrap(this.writeFile,i,!0),this.unlink=this._wrap(this.unlink,c,!0),this.readdir=this._wrap(this.readdir,c,!1),this.mkdir=this._wrap(this.mkdir,c,!0),this.rmdir=this._wrap(this.rmdir,c,!0),this.rename=this._wrap(this.rename,a,!0),this.stat=this._wrap(this.stat,c,!1),this.lstat=this._wrap(this.lstat,c,!1),this.readlink=this._wrap(this.readlink,c,!1),this.symlink=this._wrap(this.symlink,a,!0),this.backFile=this._wrap(this.backFile,c,!0),this.du=this._wrap(this.du,c,!1),this._deactivationPromise=null,this._deactivationTimeout=null,this._activationPromise=null,this._operations=new Set,e&&this.init(e,t)}async init(...e){return this._initPromiseResolve&&await this._initPromise,this._initPromise=this._init(...e),this._initPromise}async _init(e,t={}){await this._gracefulShutdown(),this._activationPromise&&await this._deactivate(),this._backend&&this._backend.destroy&&await this._backend.destroy(),this._backend=t.backend||new s,this._backend.init&&await this._backend.init(e,t),this._initPromiseResolve&&(this._initPromiseResolve(),this._initPromiseResolve=null),t.defer||this.stat("/")}async _gracefulShutdown(){this._operations.size>0&&(this._isShuttingDown=!0,await new Promise(e=>this._gracefulShutdownResolve=e),this._isShuttingDown=!1,this._gracefulShutdownResolve=null)}_wrap(e,t,h){return async(..._)=>{_=t(..._);let m={name:e.name,args:_};this._operations.add(m);try{return await this._activate(),await e.apply(this,_)}finally{this._operations.delete(m),h&&this._backend.saveSuperblock(),this._operations.size===0&&(this._deactivationTimeout||clearTimeout(this._deactivationTimeout),this._deactivationTimeout=setTimeout(this._deactivate.bind(this),500))}}}async _activate(){this._initPromise||console.warn(new Error(`Attempted to use LightningFS ${this._name} before it was initialized.`)),await this._initPromise,this._deactivationTimeout&&(clearTimeout(this._deactivationTimeout),this._deactivationTimeout=null),this._deactivationPromise&&await this._deactivationPromise,this._deactivationPromise=null,this._activationPromise||(this._activationPromise=this._backend.activate?this._backend.activate():Promise.resolve()),await this._activationPromise}async _deactivate(){return this._activationPromise&&await this._activationPromise,this._deactivationPromise||(this._deactivationPromise=this._backend.deactivate?this._backend.deactivate():Promise.resolve()),this._activationPromise=null,this._gracefulShutdownResolve&&this._gracefulShutdownResolve(),this._deactivationPromise}async readFile(e,t){return this._backend.readFile(e,t)}async writeFile(e,t,h){return await this._backend.writeFile(e,t,h),null}async unlink(e,t){return await this._backend.unlink(e,t),null}async readdir(e,t){return this._backend.readdir(e,t)}async mkdir(e,t){return await this._backend.mkdir(e,t),null}async rmdir(e,t){return await this._backend.rmdir(e,t),null}async rename(e,t){return await this._backend.rename(e,t),null}async stat(e,t){const h=await this._backend.stat(e,t);return new n(h)}async lstat(e,t){const h=await this._backend.lstat(e,t);return new n(h)}async readlink(e,t){return this._backend.readlink(e,t)}async symlink(e,t){return await this._backend.symlink(e,t),null}async backFile(e,t){return await this._backend.backFile(e,t),null}async du(e){return this._backend.du(e)}async flush(){return this._backend.flush()}},J}var X,ht;function Ht(){if(ht)return X;ht=1;const s=Et(),n=Ct();function r(c,i){return typeof c=="function"&&(i=c),i=s(i),[(...o)=>i(null,...o),i]}return X=class{constructor(...i){this.promises=new n(...i),this.init=this.init.bind(this),this.readFile=this.readFile.bind(this),this.writeFile=this.writeFile.bind(this),this.unlink=this.unlink.bind(this),this.readdir=this.readdir.bind(this),this.mkdir=this.mkdir.bind(this),this.rmdir=this.rmdir.bind(this),this.rename=this.rename.bind(this),this.stat=this.stat.bind(this),this.lstat=this.lstat.bind(this),this.readlink=this.readlink.bind(this),this.symlink=this.symlink.bind(this),this.backFile=this.backFile.bind(this),this.du=this.du.bind(this),this.flush=this.flush.bind(this)}init(i,a){return this.promises.init(i,a)}readFile(i,a,o){const[e,t]=r(a,o);this.promises.readFile(i,a).then(e).catch(t)}writeFile(i,a,o,e){const[t,h]=r(o,e);this.promises.writeFile(i,a,o).then(t).catch(h)}unlink(i,a,o){const[e,t]=r(a,o);this.promises.unlink(i,a).then(e).catch(t)}readdir(i,a,o){const[e,t]=r(a,o);this.promises.readdir(i,a).then(e).catch(t)}mkdir(i,a,o){const[e,t]=r(a,o);this.promises.mkdir(i,a).then(e).catch(t)}rmdir(i,a,o){const[e,t]=r(a,o);this.promises.rmdir(i,a).then(e).catch(t)}rename(i,a,o){const[e,t]=r(o);this.promises.rename(i,a).then(e).catch(t)}stat(i,a,o){const[e,t]=r(a,o);this.promises.stat(i).then(e).catch(t)}lstat(i,a,o){const[e,t]=r(a,o);this.promises.lstat(i).then(e).catch(t)}readlink(i,a,o){const[e,t]=r(a,o);this.promises.readlink(i).then(e).catch(t)}symlink(i,a,o){const[e,t]=r(o);this.promises.symlink(i,a).then(e).catch(t)}backFile(i,a,o){const[e,t]=r(a,o);this.promises.backFile(i,a).then(e).catch(t)}du(i,a){const[o,e]=r(a);this.promises.du(i).then(o).catch(e)}flush(i){const[a,o]=r(i);this.promises.flush().then(a).catch(o)}},X}var Gt=Ht();const Wt=gt(Gt);console.log("LOADED ESTORAGE");window.getNewRepos=async()=>{let s=await bt(),n=[];for(const r of s)n.push({name:r,bytes:await ft(r,"db.sqlite")});return n};window.downloadAssets=async s=>{for(const n of s){const r=n.name;try{let c=await kt(r,"assets"),i=new Wt("logseq_files",{wipe:!1,url:void 0,urlauto:!1,fileDbName:"logseq",fileStoreName:"logseq_files",defer:!1,db:void 0}).promises;try{if((await i.stat(`/${r}`)).type!=="dir")throw new Error("Path exists but is not a directory")}catch{try{await i.mkdir(`/${r}`)}catch{console.error(`Failed to make a lightningfs ${r} folder`)}}for(const a of c)try{if((await i.stat(`/${r}/assets/${a.name}`)).type!=="file")throw new Error("Path exists but is not a asset file")}catch{try{let o=await ft(r,`assets/${a.name}`);await i.writeFile(`/${r}/assets/${a.name}`,o),console.log(`Wrote asset file at ${r}/assets/${a.name}`)}catch{console.error(`Failed to write to lightningfs for ${r}/assets/${a.name}`)}}await pt(i)}catch(c){console.error(`Failed to find asset dir for ${r}`),console.error(c)}}};window.uploadRepos=async s=>{for(const n of s)await vt(n.name.replace(/\.zip$/i,""),n)};const pt=async(s,n="/",r="")=>{const c=await s.readdir(n);for(let i=0;i<c.length;i++){const a=c[i],o=i===c.length-1,e=n==="/"?`/${a}`:`${n}/${a}`,t=await s.stat(e);if(console.log(r+(o?"└── ":"├── ")+a),t.type==="dir"){const _=r+(o?"    ":"│   ");await pt(s,e,_)}}};
