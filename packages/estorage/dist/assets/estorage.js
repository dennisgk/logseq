(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&c(r)}).observe(document,{childList:!0,subtree:!0});function s(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(t){if(t.ep)return;t.ep=!0;const n=s(t);fetch(t.href,n)}})();const R="";function O(a,o){if(!a.ok)throw new Error(`${o} failed: ${a.status} ${a.statusText}`)}function dt(a){const o=String(a||"").replace(/^\/+/,"");return o?o.split("/").map(s=>encodeURIComponent(s)).join("/"):""}async function vt(a){const o=`${R}/estorage`,s=await fetch(o,{method:"GET",credentials:"include",signal:a?.signal});return O(s,"listDBs"),await s.json()}async function bt(a,o,s){const c=`${R}/estorage/${encodeURIComponent(a)}`,t=new FormData;t.append("file",o,o.name??"export.zip");const n=await fetch(c,{method:"POST",body:t,credentials:"include",signal:s?.signal});return O(n,"uploadDBZip"),await n.json()}async function kt(a,o,s){const c=dt(o),t=`${R}/estorage/${encodeURIComponent(a)}/${c}`,n=await fetch(t,{method:"GET",credentials:"include",signal:s?.signal,headers:{Accept:"application/json"}});return O(n,"listDBDir"),await n.json()}async function ft(a,o,s){const c=dt(o),t=`${R}/estorage/${encodeURIComponent(a)}/${c}`,n=await fetch(t,{method:"GET",credentials:"include",signal:s?.signal});O(n,"fetchDBFileBytes");const r=await n.arrayBuffer();return new Uint8Array(r)}var X=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gt(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function St(a){if(Object.prototype.hasOwnProperty.call(a,"__esModule"))return a;var o=a.default;if(typeof o=="function"){var s=function c(){var t=!1;try{t=this instanceof c}catch{}return t?Reflect.construct(o,arguments,this.constructor):o.apply(this,arguments)};s.prototype=o.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(a).forEach(function(c){var t=Object.getOwnPropertyDescriptor(a,c);Object.defineProperty(s,c,t.get?t:{enumerable:!0,get:function(){return a[c]}})}),s}var B,Z;function Et(){if(Z)return B;Z=1,B=a;function a(o){var s,c;if(typeof o!="function")throw new Error("expected a function but got "+o);return function(){return s||(s=!0,c=o.apply(this,arguments)),c}}return B}var I={},Q;function Pt(){return Q||(Q=1,(function(a){function o(u,f){var y;return u instanceof Buffer?y=u:y=Buffer.from(u.buffer,u.byteOffset,u.byteLength),y.toString(f)}var s=function(u){return Buffer.from(u)};function c(u){for(var f=0,y=Math.min(256*256,u.length+1),b=new Uint16Array(y),S=[],k=0;;){var g=f<u.length;if(!g||k>=y-1){var D=b.subarray(0,k),x=D;if(S.push(String.fromCharCode.apply(null,x)),!g)return S.join("");u=u.subarray(f),f=0,k=0}var E=u[f++];if((E&128)===0)b[k++]=E;else if((E&224)===192){var F=u[f++]&63;b[k++]=(E&31)<<6|F}else if((E&240)===224){var F=u[f++]&63,M=u[f++]&63;b[k++]=(E&31)<<12|F<<6|M}else if((E&248)===240){var F=u[f++]&63,M=u[f++]&63,yt=u[f++]&63,T=(E&7)<<18|F<<12|M<<6|yt;T>65535&&(T-=65536,b[k++]=T>>>10&1023|55296,T=56320|T&1023),b[k++]=T}}}function t(u){for(var f=0,y=u.length,b=0,S=Math.max(32,y+(y>>>1)+7),k=new Uint8Array(S>>>3<<3);f<y;){var g=u.charCodeAt(f++);if(g>=55296&&g<=56319){if(f<y){var D=u.charCodeAt(f);(D&64512)===56320&&(++f,g=((g&1023)<<10)+(D&1023)+65536)}if(g>=55296&&g<=56319)continue}if(b+4>k.length){S+=8,S*=1+f/u.length*2,S=S>>>3<<3;var x=new Uint8Array(S);x.set(k),k=x}if((g&4294967168)===0){k[b++]=g;continue}else if((g&4294965248)===0)k[b++]=g>>>6&31|192;else if((g&4294901760)===0)k[b++]=g>>>12&15|224,k[b++]=g>>>6&63|128;else if((g&4292870144)===0)k[b++]=g>>>18&7|240,k[b++]=g>>>12&63|128,k[b++]=g>>>6&63|128;else continue;k[b++]=g&63|128}return k.slice?k.slice(0,b):k.subarray(0,b)}var n="Failed to ",r=function(u,f,y){if(u)throw new Error("".concat(n).concat(f,": the '").concat(y,"' option is unsupported."))},i=typeof Buffer=="function"&&Buffer.from,e=i?s:t;function l(){this.encoding="utf-8"}l.prototype.encode=function(u,f){return r(f&&f.stream,"encode","stream"),e(u)};function d(u){var f;try{var y=new Blob([u],{type:"text/plain;charset=UTF-8"});f=URL.createObjectURL(y);var b=new XMLHttpRequest;return b.open("GET",f,!1),b.send(),b.responseText}finally{f&&URL.revokeObjectURL(f)}}var w=!i&&typeof Blob=="function"&&typeof URL=="function"&&typeof URL.createObjectURL=="function",v=["utf-8","utf8","unicode-1-1-utf-8"],h=c;i?h=o:w&&(h=function(u){try{return d(u)}catch{return c(u)}});var _="construct 'TextDecoder'",p="".concat(n," ").concat(_,": the ");function m(u,f){r(f&&f.fatal,_,"fatal"),u=u||"utf-8";var y;if(i?y=Buffer.isEncoding(u):y=v.indexOf(u.toLowerCase())!==-1,!y)throw new RangeError("".concat(p," encoding label provided ('").concat(u,"') is invalid."));this.encoding=u,this.fatal=!1,this.ignoreBOM=!1}m.prototype.decode=function(u,f){r(f&&f.stream,"decode","stream");var y;return u instanceof Uint8Array?y=u:u.buffer instanceof ArrayBuffer?y=new Uint8Array(u.buffer):y=new Uint8Array(u),h(y,this.encoding)},a.TextEncoder=a.TextEncoder||l,a.TextDecoder=a.TextDecoder||m})(typeof window<"u"?window:typeof X<"u"?X:I)),I}var q,V;function Tt(){return V||(V=1,Pt(),q={encode:a=>new TextEncoder().encode(a),decode:a=>new TextDecoder().decode(a)}),q}var j,tt;function Ft(){if(tt)return j;tt=1,j=a;function a(o,s,c){var t;return function(){if(!s)return o.apply(this,arguments);var n=this,r=arguments,i=c&&!t;if(clearTimeout(t),t=setTimeout(function(){if(t=null,!i)return o.apply(n,r)},s),i)return o.apply(this,arguments)}}return j}var L,et;function J(){if(et)return L;et=1;function a(i){if(i.length===0)return".";let e=c(i);return e=e.reduce(r,[]),s(...e)}function o(...i){let e="";for(let l of i)l.startsWith("/")?e=l:e=a(s(e,l));return e}function s(...i){if(i.length===0)return"";let e=i.join("/");return e=e.replace(/\/{2,}/g,"/"),e}function c(i){if(i.length===0)return[];if(i==="/")return["/"];let e=i.split("/");return e[e.length-1]===""&&e.pop(),i[0]==="/"?e[0]="/":e[0]!=="."&&e.unshift("."),e}function t(i){const e=i.lastIndexOf("/");if(e===-1)throw new Error(`Cannot get dirname of "${i}"`);return e===0?"/":i.slice(0,e)}function n(i){if(i==="/")throw new Error(`Cannot get basename of "${i}"`);const e=i.lastIndexOf("/");return e===-1?i:i.slice(e+1)}function r(i,e){if(i.length===0)return i.push(e),i;if(e===".")return i;if(e===".."){if(i.length===1){if(i[0]==="/")throw new Error("Unable to normalize path - traverses above root directory");if(i[0]===".")return i.push(e),i}return i[i.length-1]===".."?(i.push(".."),i):(i.pop(),i)}return i.push(e),i}return L={join:s,normalize:a,split:c,basename:n,dirname:t,resolve:o},L}var $,it;function wt(){if(it)return $;it=1;function a(i){return class extends Error{constructor(...e){super(...e),this.code=i,this.message?this.message=i+": "+this.message:this.message=i}}}const o=a("EEXIST"),s=a("ENOENT"),c=a("ENOTDIR"),t=a("ENOTEMPTY"),n=a("ETIMEDOUT"),r=a("EISDIR");return $={EEXIST:o,ENOENT:s,ENOTDIR:c,ENOTEMPTY:t,ETIMEDOUT:n,EISDIR:r},$}var N,rt;function Dt(){if(rt)return N;rt=1;const a=J(),{EEXIST:o,ENOENT:s,ENOTDIR:c,ENOTEMPTY:t,EISDIR:n}=wt(),r=0;return N=class{constructor(){}_makeRoot(e=new Map){return e.set(r,{mode:511,type:"dir",size:0,ino:0,mtimeMs:Date.now()}),e}activate(e=null){e===null?this._root=new Map([["/",this._makeRoot()]]):typeof e=="string"?this._root=new Map([["/",this._makeRoot(this.parse(e))]]):this._root=e}get activated(){return!!this._root}deactivate(){this._root=void 0}size(){return this._countInodes(this._root.get("/"))-1}_countInodes(e){let l=1;for(let[d,w]of e)d!==r&&(l+=this._countInodes(w));return l}autoinc(){return this._maxInode(this._root.get("/"))+1}_maxInode(e){let l=e.get(r).ino;for(let[d,w]of e)d!==r&&(l=Math.max(l,this._maxInode(w)));return l}print(e=this._root.get("/")){let l="";const d=(w,v)=>{for(let[h,_]of w){if(h===0)continue;let p=_.get(r),m=p.mode.toString(8);l+=`${"	".repeat(v)}${h}	${m}`,p.type==="file"?l+=`	${p.size}	${p.mtimeMs}
`:(l+=`
`,d(_,v+1))}};return d(e,0),l}parse(e){let l=0;function d(_){const p=++l,m=_.length===1?"dir":"file";let[u,f,y]=_;return u=parseInt(u,8),f=f?parseInt(f):0,y=y?parseInt(y):Date.now(),new Map([[r,{mode:u,type:m,size:f,mtimeMs:y,ino:p}]])}let w=e.trim().split(`
`),v=this._makeRoot(),h=[{indent:-1,node:v},{indent:0,node:null}];for(let _ of w){let m=_.match(/^\t*/)[0].length;_=_.slice(m);let[u,...f]=_.split("	"),y=d(f);if(m<=h[h.length-1].indent)for(;m<=h[h.length-1].indent;)h.pop();h.push({indent:m,node:y}),h[h.length-2].node.set(u,y)}return v}_lookup(e,l=!0){let d=this._root,w="/",v=a.split(e);for(let h=0;h<v.length;++h){let _=v[h];if(d=d.get(_),!d)throw new s(e);if(l||h<v.length-1){const p=d.get(r);if(p.type==="symlink"){let m=a.resolve(w,p.target);d=this._lookup(m)}w?w=a.join(w,_):w=_}}return d}mkdir(e,{mode:l}){if(e==="/")throw new o;let d=this._lookup(a.dirname(e)),w=a.basename(e);if(d.has(w))throw new o;let v=new Map,h={mode:l,type:"dir",size:0,mtimeMs:Date.now(),ino:this.autoinc()};v.set(r,h),d.set(w,v)}rmdir(e){let l=this._lookup(e);if(l.get(r).type!=="dir")throw new c;if(l.size>1)throw new t;let d=this._lookup(a.dirname(e)),w=a.basename(e);d.delete(w)}readdir(e){let l=this._lookup(e);if(l.get(r).type!=="dir")throw new c;return[...l.keys()].filter(d=>typeof d=="string")}writeStat(e,l,{mode:d}){let w,v;try{v=this.stat(e)}catch{}if(v!==void 0){if(v.type==="dir")throw new n;d==null&&(d=v.mode),w=v.ino}d==null&&(d=438),w==null&&(w=this.autoinc());let h=this._lookup(a.dirname(e)),_=a.basename(e),p={mode:d,type:"file",size:l,mtimeMs:Date.now(),ino:w},m=new Map;return m.set(r,p),h.set(_,m),p}unlink(e){let l=this._lookup(a.dirname(e)),d=a.basename(e);l.delete(d)}rename(e,l){let d=a.basename(l),w=this._lookup(e);this._lookup(a.dirname(l)).set(d,w),this.unlink(e)}stat(e){return this._lookup(e).get(r)}lstat(e){return this._lookup(e,!1).get(r)}readlink(e){return this._lookup(e,!1).get(r).target}symlink(e,l){let d,w;try{let m=this.stat(l);w===null&&(w=m.mode),d=m.ino}catch{}w==null&&(w=40960),d==null&&(d=this.autoinc());let v=this._lookup(a.dirname(l)),h=a.basename(l),_={mode:w,type:"symlink",target:e,size:0,mtimeMs:Date.now(),ino:d},p=new Map;return p.set(r,_),v.set(h,p),_}_du(e){let l=0;for(const[d,w]of e.entries())d===r?l+=w.size:l+=this._du(w);return l}du(e){let l=this._lookup(e);return this._du(l)}},N}class _t{constructor(o="keyval-store",s="keyval"){this.storeName=s,this._dbName=o,this._storeName=s,this._init()}_init(){this._dbp||(this._dbp=new Promise((o,s)=>{const c=indexedDB.open(this._dbName);c.onerror=()=>s(c.error),c.onsuccess=()=>o(c.result),c.onupgradeneeded=()=>{c.result.createObjectStore(this._storeName)}}))}_withIDBStore(o,s){return this._init(),this._dbp.then(c=>new Promise((t,n)=>{const r=c.transaction(this.storeName,o);r.oncomplete=()=>t(),r.onabort=r.onerror=()=>n(r.error),s(r.objectStore(this.storeName))}))}_close(){return this._init(),this._dbp.then(o=>{o.close(),this._dbp=void 0})}}let z;function P(){return z||(z=new _t),z}function xt(a,o=P()){let s;return o._withIDBStore("readwrite",c=>{s=c.get(a)}).then(()=>s.result)}function Rt(a,o,s=P()){return s._withIDBStore("readwrite",c=>{c.put(o,a)})}function Ot(a,o,s=P()){return s._withIDBStore("readwrite",c=>{const t=c.get(a);t.onsuccess=()=>{c.put(o(t.result),a)}})}function Mt(a,o=P()){return o._withIDBStore("readwrite",s=>{s.delete(a)})}function Bt(a=P()){return a._withIDBStore("readwrite",o=>{o.clear()})}function It(a=P()){const o=[];return a._withIDBStore("readwrite",s=>{(s.openKeyCursor||s.openCursor).call(s).onsuccess=function(){this.result&&(o.push(this.result.key),this.result.continue())}}).then(()=>o)}function qt(a=P()){return a._close()}const jt=Object.freeze(Object.defineProperty({__proto__:null,Store:_t,clear:Bt,close:qt,del:Mt,get:xt,keys:It,set:Rt,update:Ot},Symbol.toStringTag,{value:"Module"})),mt=St(jt);var A,nt;function Lt(){if(nt)return A;nt=1;const a=mt;return A=class{constructor(s,c){this._database=s,this._storename=c,this._store=new a.Store(this._database,this._storename)}saveSuperblock(s){return a.set("!root",s,this._store)}loadSuperblock(){return a.get("!root",this._store)}readFile(s){return a.get(s,this._store)}writeFile(s,c){return a.set(s,c,this._store)}unlink(s){return a.del(s,this._store)}wipe(){return a.clear(this._store)}close(){return a.close(this._store)}},A}var U,st;function $t(){return st||(st=1,U=class{constructor(o){this._url=o}loadSuperblock(){return fetch(this._url+"/.superblock.txt").then(o=>o.ok?o.text():null)}async readFile(o){const s=await fetch(this._url+o);if(s.status===200)return s.arrayBuffer();throw new Error("ENOENT")}async sizeFile(o){const s=await fetch(this._url+o,{method:"HEAD"});if(s.status===200)return s.headers.get("content-length");throw new Error("ENOENT")}}),U}var C,at;function Nt(){if(at)return C;at=1;const a=mt,o=s=>new Promise(c=>setTimeout(c,s));return C=class{constructor(c,t){this._id=Math.random(),this._database=c,this._storename=t,this._store=new a.Store(this._database,this._storename),this._lock=null}async has({margin:c=2e3}={}){if(this._lock&&this._lock.holder===this._id){const t=Date.now();return this._lock.expires>t+c?!0:await this.renew()}else return!1}async renew({ttl:c=5e3}={}){let t;return await a.update("lock",n=>{const i=Date.now()+c;return t=n&&n.holder===this._id,this._lock=t?{holder:this._id,expires:i}:n,this._lock},this._store),t}async acquire({ttl:c=5e3}={}){let t,n,r;if(await a.update("lock",i=>{const e=Date.now(),l=e+c;return n=i&&i.expires<e,t=i===void 0||n,r=i&&i.holder===this._id,this._lock=t?{holder:this._id,expires:l}:i,this._lock},this._store),r)throw new Error("Mutex double-locked");return t}async wait({interval:c=100,limit:t=6e3,ttl:n}={}){for(;t--;){if(await this.acquire({ttl:n}))return!0;await o(c)}throw new Error("Mutex timeout")}async release({force:c=!1}={}){let t,n,r;if(await a.update("lock",i=>(t=c||i&&i.holder===this._id,n=i===void 0,r=i&&i.holder!==this._id,this._lock=t?void 0:i,this._lock),this._store),await a.close(this._store),!t&&!c){if(n)throw new Error("Mutex double-freed");if(r)throw new Error("Mutex lost ownership")}return t}},C}var H,ot;function zt(){return ot||(ot=1,H=class{constructor(o){this._id=Math.random(),this._database=o,this._has=!1,this._release=null}async has(){return this._has}async acquire(){return new Promise(o=>{navigator.locks.request(this._database+"_lock",{ifAvailable:!0},s=>(this._has=!!s,o(!!s),new Promise(c=>{this._release=c})))})}async wait({timeout:o=6e5}={}){return new Promise((s,c)=>{const t=new AbortController;setTimeout(()=>{t.abort(),c(new Error("Mutex timeout"))},o),navigator.locks.request(this._database+"_lock",{signal:t.signal},n=>(this._has=!!n,s(!!n),new Promise(r=>{this._release=r})))})}async release({force:o=!1}={}){this._has=!1,this._release?this._release():o&&navigator.locks.request(this._database+"_lock",{steal:!0},s=>!0)}}),H}var G,ct;function At(){if(ct)return G;ct=1;const{encode:a,decode:o}=Tt(),s=Ft(),c=Dt(),{ENOENT:t,ENOTEMPTY:n,ETIMEDOUT:r}=wt(),i=Lt(),e=$t(),l=Nt(),d=zt(),w=J();return G=class{constructor(){this.saveSuperblock=s(()=>{this.flush()},500)}async init(h,{wipe:_,url:p,urlauto:m,fileDbName:u=h,db:f=null,fileStoreName:y=h+"_files",lockDbName:b=h+"_lock",lockStoreName:S=h+"_lock"}={}){this._name=h,this._idb=f||new i(u,y),this._mutex=navigator.locks?new d(h):new l(b,S),this._cache=new c(h),this._opts={wipe:_,url:p},this._needsWipe=!!_,p&&(this._http=new e(p),this._urlauto=!!m)}async activate(){if(this._cache.activated)return;this._needsWipe&&(this._needsWipe=!1,await this._idb.wipe(),await this._mutex.release({force:!0})),await this._mutex.has()||await this._mutex.wait();const h=await this._idb.loadSuperblock();if(h)this._cache.activate(h);else if(this._http){const _=await this._http.loadSuperblock();this._cache.activate(_),await this._saveSuperblock()}else this._cache.activate();if(!await this._mutex.has())throw new r}async deactivate(){await this._mutex.has()&&await this._saveSuperblock(),this._cache.deactivate();try{await this._mutex.release()}catch(h){console.log(h)}await this._idb.close()}async _saveSuperblock(){this._cache.activated&&(this._lastSavedAt=Date.now(),await this._idb.saveSuperblock(this._cache._root))}_writeStat(h,_,p){let m=w.split(w.dirname(h)),u=m.shift();for(let f of m){u=w.join(u,f);try{this._cache.mkdir(u,{mode:511})}catch{}}return this._cache.writeStat(h,_,p)}async readFile(h,_){const p=typeof _=="string"?_:_&&_.encoding;if(p&&p!=="utf8")throw new Error('Only "utf8" encoding is supported in readFile');let m=null,u=null;try{u=this._cache.stat(h),m=await this._idb.readFile(u.ino)}catch(f){if(!this._urlauto)throw f}if(!m&&this._http){let f=this._cache.lstat(h);for(;f.type==="symlink";)h=w.resolve(w.dirname(h),f.target),f=this._cache.lstat(h);m=await this._http.readFile(h)}if(m&&((!u||u.size!=m.byteLength)&&(u=await this._writeStat(h,m.byteLength,{mode:u?u.mode:438}),this.saveSuperblock()),p==="utf8"?m=o(m):m.toString=()=>o(m)),!u)throw new t(h);return m}async writeFile(h,_,p){const{mode:m,encoding:u="utf8"}=p;if(typeof _=="string"){if(u!=="utf8")throw new Error('Only "utf8" encoding is supported in writeFile');_=a(_)}const f=await this._cache.writeStat(h,_.byteLength,{mode:m});await this._idb.writeFile(f.ino,_)}async unlink(h,_){const p=this._cache.lstat(h);this._cache.unlink(h),p.type!=="symlink"&&await this._idb.unlink(p.ino)}readdir(h,_){return this._cache.readdir(h)}mkdir(h,_){const{mode:p=511}=_;this._cache.mkdir(h,{mode:p})}rmdir(h,_){if(h==="/")throw new n;this._cache.rmdir(h)}rename(h,_){this._cache.rename(h,_)}stat(h,_){return this._cache.stat(h)}lstat(h,_){return this._cache.lstat(h)}readlink(h,_){return this._cache.readlink(h)}symlink(h,_){this._cache.symlink(h,_)}async backFile(h,_){let p=await this._http.sizeFile(h);await this._writeStat(h,p,_)}du(h){return this._cache.du(h)}flush(){return this._saveSuperblock()}},G}var K,lt;function Ut(){return lt||(lt=1,K=class{constructor(o){this.type=o.type,this.mode=o.mode,this.size=o.size,this.ino=o.ino,this.mtimeMs=o.mtimeMs,this.ctimeMs=o.ctimeMs||o.mtimeMs,this.uid=1,this.gid=1,this.dev=1}isFile(){return this.type==="file"}isDirectory(){return this.type==="dir"}isSymbolicLink(){return this.type==="symlink"}}),K}var W,ht;function Ct(){if(ht)return W;ht=1;const a=At(),o=Ut(),s=J();function c(r,i,...e){return r=s.normalize(r),(typeof i>"u"||typeof i=="function")&&(i={}),typeof i=="string"&&(i={encoding:i}),[r,i,...e]}function t(r,i,e,...l){return r=s.normalize(r),(typeof e>"u"||typeof e=="function")&&(e={}),typeof e=="string"&&(e={encoding:e}),[r,i,e,...l]}function n(r,i,...e){return[s.normalize(r),s.normalize(i),...e]}return W=class{constructor(i,e={}){this.init=this.init.bind(this),this.readFile=this._wrap(this.readFile,c,!1),this.writeFile=this._wrap(this.writeFile,t,!0),this.unlink=this._wrap(this.unlink,c,!0),this.readdir=this._wrap(this.readdir,c,!1),this.mkdir=this._wrap(this.mkdir,c,!0),this.rmdir=this._wrap(this.rmdir,c,!0),this.rename=this._wrap(this.rename,n,!0),this.stat=this._wrap(this.stat,c,!1),this.lstat=this._wrap(this.lstat,c,!1),this.readlink=this._wrap(this.readlink,c,!1),this.symlink=this._wrap(this.symlink,n,!0),this.backFile=this._wrap(this.backFile,c,!0),this.du=this._wrap(this.du,c,!1),this._deactivationPromise=null,this._deactivationTimeout=null,this._activationPromise=null,this._operations=new Set,i&&this.init(i,e)}async init(...i){return this._initPromiseResolve&&await this._initPromise,this._initPromise=this._init(...i),this._initPromise}async _init(i,e={}){await this._gracefulShutdown(),this._activationPromise&&await this._deactivate(),this._backend&&this._backend.destroy&&await this._backend.destroy(),this._backend=e.backend||new a,this._backend.init&&await this._backend.init(i,e),this._initPromiseResolve&&(this._initPromiseResolve(),this._initPromiseResolve=null),e.defer||this.stat("/")}async _gracefulShutdown(){this._operations.size>0&&(this._isShuttingDown=!0,await new Promise(i=>this._gracefulShutdownResolve=i),this._isShuttingDown=!1,this._gracefulShutdownResolve=null)}_wrap(i,e,l){return async(...d)=>{d=e(...d);let w={name:i.name,args:d};this._operations.add(w);try{return await this._activate(),await i.apply(this,d)}finally{this._operations.delete(w),l&&this._backend.saveSuperblock(),this._operations.size===0&&(this._deactivationTimeout||clearTimeout(this._deactivationTimeout),this._deactivationTimeout=setTimeout(this._deactivate.bind(this),500))}}}async _activate(){this._initPromise||console.warn(new Error(`Attempted to use LightningFS ${this._name} before it was initialized.`)),await this._initPromise,this._deactivationTimeout&&(clearTimeout(this._deactivationTimeout),this._deactivationTimeout=null),this._deactivationPromise&&await this._deactivationPromise,this._deactivationPromise=null,this._activationPromise||(this._activationPromise=this._backend.activate?this._backend.activate():Promise.resolve()),await this._activationPromise}async _deactivate(){return this._activationPromise&&await this._activationPromise,this._deactivationPromise||(this._deactivationPromise=this._backend.deactivate?this._backend.deactivate():Promise.resolve()),this._activationPromise=null,this._gracefulShutdownResolve&&this._gracefulShutdownResolve(),this._deactivationPromise}async readFile(i,e){return this._backend.readFile(i,e)}async writeFile(i,e,l){return await this._backend.writeFile(i,e,l),null}async unlink(i,e){return await this._backend.unlink(i,e),null}async readdir(i,e){return this._backend.readdir(i,e)}async mkdir(i,e){return await this._backend.mkdir(i,e),null}async rmdir(i,e){return await this._backend.rmdir(i,e),null}async rename(i,e){return await this._backend.rename(i,e),null}async stat(i,e){const l=await this._backend.stat(i,e);return new o(l)}async lstat(i,e){const l=await this._backend.lstat(i,e);return new o(l)}async readlink(i,e){return this._backend.readlink(i,e)}async symlink(i,e){return await this._backend.symlink(i,e),null}async backFile(i,e){return await this._backend.backFile(i,e),null}async du(i){return this._backend.du(i)}async flush(){return this._backend.flush()}},W}var Y,ut;function Ht(){if(ut)return Y;ut=1;const a=Et(),o=Ct();function s(c,t){return typeof c=="function"&&(t=c),t=a(t),[(...r)=>t(null,...r),t]}return Y=class{constructor(...t){this.promises=new o(...t),this.init=this.init.bind(this),this.readFile=this.readFile.bind(this),this.writeFile=this.writeFile.bind(this),this.unlink=this.unlink.bind(this),this.readdir=this.readdir.bind(this),this.mkdir=this.mkdir.bind(this),this.rmdir=this.rmdir.bind(this),this.rename=this.rename.bind(this),this.stat=this.stat.bind(this),this.lstat=this.lstat.bind(this),this.readlink=this.readlink.bind(this),this.symlink=this.symlink.bind(this),this.backFile=this.backFile.bind(this),this.du=this.du.bind(this),this.flush=this.flush.bind(this)}init(t,n){return this.promises.init(t,n)}readFile(t,n,r){const[i,e]=s(n,r);this.promises.readFile(t,n).then(i).catch(e)}writeFile(t,n,r,i){const[e,l]=s(r,i);this.promises.writeFile(t,n,r).then(e).catch(l)}unlink(t,n,r){const[i,e]=s(n,r);this.promises.unlink(t,n).then(i).catch(e)}readdir(t,n,r){const[i,e]=s(n,r);this.promises.readdir(t,n).then(i).catch(e)}mkdir(t,n,r){const[i,e]=s(n,r);this.promises.mkdir(t,n).then(i).catch(e)}rmdir(t,n,r){const[i,e]=s(n,r);this.promises.rmdir(t,n).then(i).catch(e)}rename(t,n,r){const[i,e]=s(r);this.promises.rename(t,n).then(i).catch(e)}stat(t,n,r){const[i,e]=s(n,r);this.promises.stat(t).then(i).catch(e)}lstat(t,n,r){const[i,e]=s(n,r);this.promises.lstat(t).then(i).catch(e)}readlink(t,n,r){const[i,e]=s(n,r);this.promises.readlink(t).then(i).catch(e)}symlink(t,n,r){const[i,e]=s(r);this.promises.symlink(t,n).then(i).catch(e)}backFile(t,n,r){const[i,e]=s(n,r);this.promises.backFile(t,n).then(i).catch(e)}du(t,n){const[r,i]=s(n);this.promises.du(t).then(r).catch(i)}flush(t){const[n,r]=s(t);this.promises.flush().then(n).catch(r)}},Y}var Gt=Ht();const Kt=gt(Gt);console.log("LOADED ESTORAGE");window.getNewRepos=async()=>{let a=await vt(),o=[];for(const s of a)o.push({name:s,bytes:await ft(s,"db.sqlite")});return o};window.downloadAssets=async a=>{for(const o of a){const s=o.name;try{let c=await kt(s,"assets"),t=new Kt("logseq_files",{wipe:!1,url:void 0,urlauto:!1,fileDbName:"logseq",fileStoreName:"logseq_files",defer:!1,db:void 0}).promises;try{if((await t.stat(`/${s}`)).type!=="dir")throw new Error("Path exists but is not a directory")}catch{try{await t.mkdir(`/${s}`)}catch{console.error(`Failed to make a lightningfs ${s} folder`)}}for(const n of c)try{if((await t.stat(`/${s}/assets/${n.name}`)).type!=="file")throw new Error("Path exists but is not a asset file")}catch{try{let r=await ft(s,`assets/${n.name}`);await t.writeFile(`/${s}/assets/${n.name}`,r),console.log(`Wrote asset file at ${s}/assets/${n.name}`)}catch{console.error(`Failed to write to lightningfs for ${s}/assets/${n.name}`)}}await pt(t)}catch(c){console.error(`Failed to find asset dir for ${s}`),console.error(c)}}};window.uploadRepos=async a=>{for(const o of a)await bt(o.name.replace(/\.zip$/i,""),o)};const pt=async(a,o="/",s="")=>{const c=await a.readdir(o);for(let t=0;t<c.length;t++){const n=c[t],r=t===c.length-1,i=o==="/"?`/${n}`:`${o}/${n}`,e=await a.stat(i);if(console.log(s+(r?"└── ":"├── ")+n),e.type==="dir"){const d=s+(r?"    ":"│   ");await pt(a,i,d)}}};(function(){const o="__routingKillSwitch__";function s(c){try{const t=c!=null?String(c):null;t?window.location.href=t:window.location.reload()}catch{window.location.reload()}}window.disableSpaRouting=function(){if(window[o]?.enabled)return;const t=window,n=t.history,r=t[o]||(t[o]={});r.enabled=!0,r.history={pushState:n.pushState,replaceState:n.replaceState,back:n.back,forward:n.forward,go:n.go},r.window={addEventListener:t.addEventListener,removeEventListener:t.removeEventListener,locationAssign:t.location.assign.bind(t.location),locationReplace:t.location.replace.bind(t.location)},r.listeners=r.listeners||[],r.blockedEvents=new Set(["popstate","hashchange"]),n.pushState=function(l,d,w){s(w)},n.replaceState=function(l,d,w){s(w)},n.back=function(){r.history.back.call(n),setTimeout(()=>t.location.reload(),0)},n.forward=function(){r.history.forward.call(n),setTimeout(()=>t.location.reload(),0)},n.go=function(l){r.history.go.call(n,l),setTimeout(()=>t.location.reload(),0)},t.addEventListener=function(l,d,w){if(r.blockedEvents.has(l)){r.listeners.push({type:l,listener:d,options:w});return}return r.window.addEventListener.call(t,l,d,w)},t.removeEventListener=function(l,d,w){if(r.blockedEvents.has(l)){r.listeners=r.listeners.filter(v=>!(v.type===l&&v.listener===d));return}return r.window.removeEventListener.call(t,l,d,w)};const i=l=>{l?.preventDefault?.(),t.location.replace(t.location.href)};r.killSwitchHandlers=r.killSwitchHandlers||{},r.killSwitchHandlers.hashchange=i,r.window.addEventListener.call(t,"hashchange",i,!0);const e=l=>{l?.preventDefault?.(),t.location.reload()};r.killSwitchHandlers.popstate=e,r.window.addEventListener.call(t,"popstate",e,!0)},window.restoreSpaRouting=function(){const t=window[o];if(!t?.enabled)return;const n=window,r=n.history;if(t.history&&(r.pushState=t.history.pushState,r.replaceState=t.history.replaceState,r.back=t.history.back,r.forward=t.history.forward,r.go=t.history.go),t.window&&(n.addEventListener=t.window.addEventListener,n.removeEventListener=t.window.removeEventListener),t.killSwitchHandlers?.hashchange&&t.window.removeEventListener.call(n,"hashchange",t.killSwitchHandlers.hashchange,!0),t.killSwitchHandlers?.popstate&&t.window.removeEventListener.call(n,"popstate",t.killSwitchHandlers.popstate,!0),Array.isArray(t.listeners)&&t.listeners.length){for(const{type:i,listener:e,options:l}of t.listeners)t.window.addEventListener.call(n,i,e,l);t.listeners=[]}t.enabled=!1}})();
